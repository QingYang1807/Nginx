<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>交互式 Nginx 手册</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals (Slate, Stone, Teal) -->
    <!-- Application Structure Plan: 采用“引导式学习与快速参考”模型。左侧是固定的、按任务和概念分组的导航栏（入门、核心配置、核心功能、高级主题、速查表），右侧是动态内容区。这种结构允许用户按学习路径探索，或直接跳转到特定主题。通过将线性文档重构为非线性的、基于任务的结构，极大地提高了信息的可发现性和易用性。 -->
    <!-- Visualization & Content Choices: 1. Nginx vs Apache：使用清晰的HTML表格进行对比，直观易懂。2. 安装指南：使用标签页（Tabs）分离不同平台的安装步骤，避免信息混杂。3. 配置结构：用HTML/CSS构建可交互的配置文​​件结构图，点击不同部分（http, server, location）可显示相关指令说明，将抽象的层级关系可视化。4. 负载均衡算法：使用Chart.js动态条形图模拟请求分发，用户点击按钮可看到不同算法（轮询、最少连接、IP哈希）下服务器负载的实时变化，将算法行为动态化，这是“WOW”因素的关键。5. 性能计算器：通过简单的JS输入和输出，将公式（如最大连接数）具象化。所有选择都旨在用互动和视觉化元素取代静态文本，提升学习体验。 -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 40vh;
        }
        .nav-link {
            display: block;
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s, color 0.2s;
            color: #cbd5e1; /* slate-300 */
        }
        .nav-link:hover {
            background-color: #334155; /* slate-700 */
            color: #ffffff;
        }
        .nav-link.active {
            background-color: #0d9488; /* teal-600 */
            color: #ffffff;
            font-weight: 600;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .code-block {
            background-color: #1e293b; /* slate-800 */
            color: #e2e8f0; /* slate-200 */
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            position: relative;
        }
        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #475569; /* slate-600 */
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .copy-btn:hover {
            background-color: #64748b; /* slate-500 */
        }
        .tab {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-bottom: 2px solid transparent;
        }
        .tab.active {
            border-color: #0d9488; /* teal-600 */
            color: #0d9488;
            font-weight: 600;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="flex h-screen bg-slate-50">
        <!-- Sidebar Navigation -->
        <aside class="w-64 bg-slate-800 text-slate-200 p-4 space-y-6 overflow-y-auto">
            <div class="text-white text-2xl font-bold text-center">
                Nginx 手册
            </div>
            <nav>
                <h3 class="px-4 text-sm font-semibold text-slate-400 uppercase tracking-wider mb-2">入门</h3>
                <a href="#intro" class="nav-link active">🚀 简介与核心特性</a>
                <a href="#install" class="nav-link">📦 安装指南</a>

                <h3 class="mt-6 px-4 text-sm font-semibold text-slate-400 uppercase tracking-wider mb-2">核心配置</h3>
                <a href="#config-structure" class="nav-link">🏗️ 配置文件结构</a>
                <a href="#static-content" class="nav-link">🖼️ 静态内容服务</a>
                
                <h3 class="mt-6 px-4 text-sm font-semibold text-slate-400 uppercase tracking-wider mb-2">核心功能</h3>
                <a href="#reverse-proxy" class="nav-link">📡 反向代理</a>
                <a href="#load-balancing" class="nav-link">⚖️ 负载均衡</a>

                <h3 class="mt-6 px-4 text-sm font-semibold text-slate-400 uppercase tracking-wider mb-2">高级主题</h3>
                <a href="#performance" class="nav-link">⚡ 性能优化</a>
                <a href="#security" class="nav-link">🛡️ 安全加固</a>
                
                <h3 class="mt-6 px-4 text-sm font-semibold text-slate-400 uppercase tracking-wider mb-2">快速参考</h3>
                <a href="#cheatsheet" class="nav-link">📋 常用指令速查</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6 lg:p-10 overflow-y-auto">
            
            <!-- Section: Introduction -->
            <section id="intro" class="content-section active">
                <h1 class="text-4xl font-bold text-slate-900">Nginx: 高性能 Web 服务器</h1>
                <p class="mt-4 text-lg text-slate-600">Nginx (发音为 "engine-x") 是一款高性能的HTTP和反向代理服务器。本交互式手册将帮助您从入门到精通，掌握其核心概念与实践。</p>

                <div class="mt-10 grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h3 class="text-xl font-semibold text-teal-700">高并发与高性能</h3>
                        <p class="mt-2 text-slate-600">采用异步、事件驱动架构，单个工作进程可处理数千并发连接，内存占用极低。</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h3 class="text-xl font-semibold text-teal-700">强大的反向代理</h3>
                        <p class="mt-2 text-slate-600">作为反向代理，可实现负载均衡、SSL终止、缓存静态内容，提升应用安全性和可伸缩性。</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h3 class="text-xl font-semibold text-teal-700">灵活的负载均衡</h3>
                        <p class="mt-2 text-slate-600">支持轮询、最少连接、IP哈希等多种算法，有效分发流量至后端服务器集群。</p>
                    </div>
                </div>

                <h2 class="text-3xl font-bold text-slate-900 mt-12 mb-6">Nginx vs. Apache</h2>
                <div class="overflow-x-auto bg-white rounded-lg shadow-sm">
                    <table class="w-full text-left">
                        <thead class="bg-slate-100">
                            <tr>
                                <th class="p-4 font-semibold">特性</th>
                                <th class="p-4 font-semibold">Nginx</th>
                                <th class="p-4 font-semibold">Apache</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-200">
                            <tr>
                                <td class="p-4 font-medium">架构模型</td>
                                <td class="p-4">事件驱动，异步非阻塞</td>
                                <td class="p-4">进程驱动/线程驱动</td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium">并发处理</td>
                                <td class="p-4 text-green-600 font-semibold">非常高，资源消耗低</td>
                                <td class="p-4">良好，高并发下资源消耗高</td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium">静态内容</td>
                                <td class="p-4 text-green-600 font-semibold">性能极高</td>
                                <td class="p-4">良好</td>
                            </tr>
                             <tr>
                                <td class="p-4 font-medium">动态内容</td>
                                <td class="p-4">通过FastCGI等代理给后端处理</td>
                                <td class="p-4">可内嵌模块 (mod_php) 直接处理</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section: Installation -->
            <section id="install" class="content-section">
                <h1 class="text-4xl font-bold text-slate-900">安装指南</h1>
                <p class="mt-4 text-lg text-slate-600">根据您的操作系统平台，选择对应的安装方式。我们推荐使用官方源或稳定可靠的软件仓库进行安装。</p>
                
                <div class="mt-8 bg-white p-6 rounded-lg shadow-sm">
                    <div id="install-tabs" class="flex border-b border-slate-200 mb-6">
                        <div class="tab active" data-target="ubuntu">Ubuntu</div>
                        <div class="tab" data-target="centos">CentOS</div>
                        <div class="tab" data-target="docker">Docker</div>
                        <div class="tab" data-target="wsl">WSL</div>
                    </div>

                    <div id="ubuntu" class="tab-content active">
                        <h3 class="text-2xl font-semibold mb-4">在 Ubuntu 上安装</h3>
                        <p class="mb-4">使用 `apt` 包管理器是最直接的方式。</p>
                        <h4 class="font-semibold mb-2">1. 更新包列表并安装 Nginx:</h4>
                        <div class="code-block" id="code-ubuntu-install">
                            <button class="copy-btn" onclick="copyToClipboard('code-ubuntu-install')">复制</button>
                            <pre><code>sudo apt update
sudo apt install nginx</code></pre>
                        </div>
                        <h4 class="font-semibold mt-6 mb-2">2. 配置防火墙 (UFW):</h4>
                         <div class="code-block" id="code-ubuntu-fw">
                             <button class="copy-btn" onclick="copyToClipboard('code-ubuntu-fw')">复制</button>
                            <pre><code>sudo ufw allow 'Nginx Full'
sudo ufw enable</code></pre>
                        </div>
                    </div>

                    <div id="centos" class="tab-content">
                        <h3 class="text-2xl font-semibold mb-4">在 CentOS 上安装</h3>
                        <p class="mb-4">推荐使用 EPEL 仓库或 Nginx 官方仓库。</p>
                        <h4 class="font-semibold mb-2">1. 安装 EPEL 并安装 Nginx:</h4>
                        <div class="code-block" id="code-centos-install">
                            <button class="copy-btn" onclick="copyToClipboard('code-centos-install')">复制</button>
                            <pre><code>sudo yum install epel-release -y
sudo yum install nginx -y</code></pre>
                        </div>
                        <h4 class="font-semibold mt-6 mb-2">2. 启动服务并配置防火墙:</h4>
                         <div class="code-block" id="code-centos-fw">
                            <button class="copy-btn" onclick="copyToClipboard('code-centos-fw')">复制</button>
                            <pre><code>sudo systemctl start nginx
sudo systemctl enable nginx
sudo firewall-cmd --permanent --add-service=http --add-service=https
sudo firewall-cmd --reload</code></pre>
                        </div>
                    </div>

                    <div id="docker" class="tab-content">
                        <h3 class="text-2xl font-semibold mb-4">使用 Docker 部署</h3>
                        <p class="mb-4">Docker 提供了轻量、隔离的部署环境。</p>
                        <h4 class="font-semibold mb-2">1. 运行一个简单的 Nginx 容器:</h4>
                        <div class="code-block" id="code-docker-run">
                            <button class="copy-btn" onclick="copyToClipboard('code-docker-run')">复制</button>
                            <pre><code>docker run --name my-nginx -p 8080:80 -d nginx</code></pre>
                        </div>
                        <p class="mt-2 text-sm text-slate-500">此命令会将主机的 8080 端口映射到容器的 80 端口。</p>
                        <h4 class="font-semibold mt-6 mb-2">2. 挂载自定义内容和配置:</h4>
                         <div class="code-block" id="code-docker-mount">
                            <button class="copy-btn" onclick="copyToClipboard('code-docker-mount')">复制</button>
                            <pre><code>docker run --name my-custom-nginx -p 8080:80 -d \
  -v /path/to/your/content:/usr/share/nginx/html:ro \
  -v /path/to/your/conf.d:/etc/nginx/conf.d:ro \
  nginx</code></pre>
                        </div>
                    </div>

                    <div id="wsl" class="tab-content">
                        <h3 class="text-2xl font-semibold mb-4">在 WSL (Windows Subsystem for Linux) 上安装</h3>
                        <p class="mb-4">安装过程与在原生 Linux 发行版 (如Ubuntu) 上基本一致。</p>
                        <h4 class="font-semibold mb-2">1. 在您的 WSL (Ubuntu) 终端中执行:</h4>
                        <div class="code-block" id="code-wsl-install">
                            <button class="copy-btn" onclick="copyToClipboard('code-wsl-install')">复制</button>
                            <pre><code>sudo apt update
sudo apt install nginx</code></pre>
                        </div>
                        <h4 class="font-semibold mt-6 mb-2">2. 启动服务:</h4>
                         <div class="code-block" id="code-wsl-start">
                            <button class="copy-btn" onclick="copyToClipboard('code-wsl-start')">复制</button>
                            <pre><code>sudo service nginx start</code></pre>
                        </div>
                        <p class="mt-2 text-sm text-slate-500">WSL 可能不支持 `systemctl`，请使用 `service` 命令。启动后，您可以在 Windows 浏览器中通过 `http://localhost` 访问。</p>
                    </div>
                </div>
            </section>

            <!-- Section: Config Structure -->
            <section id="config-structure" class="content-section">
                 <h1 class="text-4xl font-bold text-slate-900">配置文件结构</h1>
                 <p class="mt-4 text-lg text-slate-600">Nginx 的配置由一系列指令和块组成。理解其层级结构是配置的关键。点击下方图示的不同区块来查看其核心指令和作用。</p>
                 
                 <div class="mt-8 flex flex-col md:flex-row gap-6">
                    <!-- Interactive Diagram -->
                    <div class="md:w-1/2 lg:w-2/5">
                        <div id="config-diagram" class="bg-slate-800 p-4 rounded-lg text-white font-mono text-sm">
                            <div class="diagram-block" data-target="main-context">
                                <span class="text-purple-400">user</span> www-data;<br>
                                <span class="text-purple-400">worker_processes</span> auto;
                                <div class="diagram-block mt-2" data-target="events-context">
                                    <span class="text-yellow-400">events</span> {<br>
                                    <span class="pl-4 text-purple-400">worker_connections</span> 768;<br>
                                    }
                                </div>
                                <div class="diagram-block mt-2 diagram-clickable active" data-target="http-context">
                                    <span class="text-yellow-400">http</span> {<br>
                                    <div class="pl-4 diagram-block diagram-clickable" data-target="server-context">
                                        <span class="text-green-400">server</span> {<br>
                                        <span class="pl-8 text-blue-400">listen</span> 80;<br>
                                        <span class="pl-8 text-blue-400">server_name</span> example.com;<br>
                                        <div class="pl-8 diagram-block diagram-clickable" data-target="location-context">
                                            <span class="text-cyan-400">location</span> / {<br>
                                            <span class="pl-12 text-orange-400">root</span> /var/www/html;<br>
                                            <span class="pl-12 text-orange-400">try_files</span> $uri /index.html;<br>
                                            }<br>
                                        </div>
                                        }<br>
                                    </div>
                                    <span class="pl-4">...</span><br>
                                    }<br>
                                </div>
                            </div>
                        </div>
                        <style>
                        .diagram-block { border-left: 2px solid #475569; padding-left: 1rem; }
                        .diagram-clickable { cursor: pointer; transition: background-color 0.2s; border-left-color: #94a3b8; }
                        .diagram-clickable:hover { background-color: #334155; }
                        .diagram-clickable.active { background-color: #0d948830; border-left: 2px solid #0d9488; }
                        </style>
                    </div>

                    <!-- Info Panel -->
                    <div class="md:w-1/2 lg:w-3/5 bg-white p-6 rounded-lg shadow-sm">
                        <div id="main-context" class="config-info">...</div>
                        <div id="events-context" class="config-info">...</div>
                        <div id="http-context" class="config-info">
                            <h3 class="text-2xl font-semibold mb-2 text-yellow-600">http 块</h3>
                            <p class="mb-4">定义HTTP服务器的主要配置，所有 `server` 块都位于此块内。</p>
                            <ul class="list-disc list-inside space-y-2 text-slate-700">
                                <li><code>include mime.types;</code>: 包含MIME类型映射文件。</li>
                                <li><code>access_log</code>: 设置访问日志的路径和格式。</li>
                                <li><code>sendfile on;</code>: 启用高效的文件传输模式。</li>
                                <li><code>keepalive_timeout</code>: 设置长连接的超时时间。</li>
                            </ul>
                        </div>
                         <div id="server-context" class="config-info hidden">
                            <h3 class="text-2xl font-semibold mb-2 text-green-600">server 块</h3>
                            <p class="mb-4">定义一个虚拟主机，用于处理特定域名和端口的请求。</p>
                            <ul class="list-disc list-inside space-y-2 text-slate-700">
                                <li><code>listen</code>: 指定监听的端口和IP，如 `listen 80;` 或 `listen 443 ssl;`。</li>
                                <li><code>server_name</code>: 指定此虚拟主机响应的域名，如 `example.com www.example.com`。</li>
                                <li><code>root</code>: 定义该虚拟主机的文档根目录。</li>
                                <li><code>index</code>: 指定目录的默认索引文件。</li>
                            </ul>
                        </div>
                         <div id="location-context" class="config-info hidden">
                            <h3 class="text-2xl font-semibold mb-2 text-cyan-600">location 块</h3>
                            <p class="mb-4">根据请求的URI匹配并定义如何处理请求。</p>
                            <ul class="list-disc list-inside space-y-2 text-slate-700">
                                <li><code>location /path/ {...}</code>: 前缀匹配。</li>
                                <li><code>location ~ \.jpg$ {...}</code>: 正则表达式匹配。</li>
                                <li><code>root</code> / <code>alias</code>: 指定服务该location的文件系统路径。</li>
                                <li><code>proxy_pass</code>: 将请求转发给后端服务器。</li>
                                <li><code>try_files</code>: 按顺序检查文件是否存在，常用于单页应用。</li>
                            </ul>
                        </div>
                    </div>
                 </div>
            </section>

            <!-- Section: Static Content -->
            <section id="static-content" class="content-section">
                <h1 class="text-4xl font-bold text-slate-900">静态内容服务</h1>
                <p class="mt-4 text-lg text-slate-600">Nginx 在服务静态文件（如HTML, CSS, JS, 图片）方面极为高效。核心指令是 `root` 和 `alias`。</p>

                <div class="mt-8 grid md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h3 class="text-2xl font-semibold mb-4">`root` 指令</h3>
                        <p class="mb-4">将请求的 URI 附加到 `root` 指定的路径后，形成完整的文件路径。</p>
                        <div class="code-block" id="code-root-example">
                             <button class="copy-btn" onclick="copyToClipboard('code-root-example')">复制</button>
                            <pre><code>location /images/ {
    root /data/www;
}
# 请求 /images/cat.jpg
# -> 查找 /data/www/images/cat.jpg</code></pre>
                        </div>
                    </div>
                     <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h3 class="text-2xl font-semibold mb-4">`alias` 指令</h3>
                        <p class="mb-4">用 `alias` 指定的路径替换掉 `location` 匹配的URI部分。</p>
                        <div class="code-block" id="code-alias-example">
                             <button class="copy-btn" onclick="copyToClipboard('code-alias-example')">复制</button>
                            <pre><code>location /images/ {
    alias /data/assets/;
}
# 请求 /images/cat.jpg
# -> 查找 /data/assets/cat.jpg</code></pre>
                        </div>
                    </div>
                </div>

                <h3 class="text-2xl font-semibold mt-10 mb-4">单页应用 (SPA) 配置示例</h3>
                <p class="mb-4">`try_files` 是配置Vue、React等单页应用的关键，它将所有找不到文件的请求都转发给 `index.html`，交由前端路由处理。</p>
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <div class="code-block" id="code-spa-example">
                         <button class="copy-btn" onclick="copyToClipboard('code-spa-example')">复制</button>
                        <pre><code>server {
    listen 80;
    server_name my-spa.com;
    root /var/www/my-spa/dist;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Section: Reverse Proxy -->
            <section id="reverse-proxy" class="content-section">
                <h1 class="text-4xl font-bold text-slate-900">反向代理</h1>
                <p class="mt-4 text-lg text-slate-600">Nginx 最核心的功能之一。它接收客户端请求，转发给后端应用服务器，并将响应返回给客户端。</p>
                <h3 class="text-2xl font-semibold mt-10 mb-4">基本配置</h3>
                <p class="mb-4">使用 `proxy_pass` 将请求代理到后端。同时，使用 `proxy_set_header` 将客户端的真实信息（如IP地址、Host）传递给后端。</p>
                 <div class="bg-white p-6 rounded-lg shadow-sm">
                    <div class="code-block" id="code-proxy-example">
                         <button class="copy-btn" onclick="copyToClipboard('code-proxy-example')">复制</button>
                        <pre><code>location /api/ {
    proxy_pass http://127.0.0.1:3000;

    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}</code></pre>
                    </div>
                </div>

                <h3 class="text-2xl font-semibold mt-10 mb-4">代理 WebSocket</h3>
                <p class="mb-4">代理 WebSocket 需要正确处理 `Upgrade` 和 `Connection` 头部，以完成协议升级。</p>
                 <div class="bg-white p-6 rounded-lg shadow-sm">
                    <div class="code-block" id="code-ws-example">
                         <button class="copy-btn" onclick="copyToClipboard('code-ws-example')">复制</button>
                        <pre><code>location /socket/ {
    proxy_pass http://backend_websocket_server;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_read_timeout 86400s; # 保持长连接
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Section: Load Balancing -->
            <section id="load-balancing" class="content-section">
                <h1 class="text-4xl font-bold text-slate-900">负载均衡</h1>
                <p class="mt-4 text-lg text-slate-600">通过 `upstream` 模块将流量分发到多个后端服务器，提高应用的可用性和可伸缩性。点击下方按钮，查看不同算法如何分发10个模拟请求。</p>

                <div class="mt-8 bg-white p-6 rounded-lg shadow-sm">
                    <div class="flex items-center justify-center space-x-4 mb-6">
                        <button id="btn-round-robin" class="bg-teal-600 text-white px-4 py-2 rounded-md hover:bg-teal-700 transition">轮询 (Round Robin)</button>
                        <button id="btn-least-conn" class="bg-sky-600 text-white px-4 py-2 rounded-md hover:bg-sky-700 transition">最少连接 (Least Conn)</button>
                        <button id="btn-ip-hash" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition">IP 哈希 (IP Hash)</button>
                    </div>
                    <div class="chart-container">
                        <canvas id="lb-chart"></canvas>
                    </div>
                    <div id="lb-explanation" class="mt-4 text-center text-slate-600">选择一种算法开始模拟。</div>
                </div>

                 <h3 class="text-2xl font-semibold mt-10 mb-4">Upstream 配置示例</h3>
                 <div class="bg-white p-6 rounded-lg shadow-sm">
                    <div class="code-block" id="code-lb-example">
                         <button class="copy-btn" onclick="copyToClipboard('code-lb-example')">复制</button>
                        <pre><code>http {
    upstream my_backend {
        # least_conn; # 或者 ip_hash;
        server backend1.example.com weight=3;
        server backend2.example.com;
        server backend3.example.com backup;
    }

    server {
        location / {
            proxy_pass http://my_backend;
        }
    }
}</code></pre>
                    </div>
                </div>

            </section>

            <!-- Section: Performance -->
            <section id="performance" class="content-section">
                <h1 class="text-4xl font-bold text-slate-900">性能优化</h1>
                <p class="mt-4 text-lg text-slate-600">通过调整 Worker 进程和连接处理参数，可以显著提升 Nginx 在高负载下的表现。</p>

                <div class="mt-8 grid md:grid-cols-2 gap-8">
                     <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h3 class="text-2xl font-semibold mb-4">Worker 配置</h3>
                        <p class="mb-4">`worker_processes` 通常应设置为服务器的CPU核心数，以充分利用硬件资源并减少上下文切换。</p>
                         <div class="code-block" id="code-perf-worker">
                             <button class="copy-btn" onclick="copyToClipboard('code-perf-worker')">复制</button>
                            <pre><code># 通常在 nginx.conf 的顶层
worker_processes auto;</code></pre>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h3 class="text-2xl font-semibold mb-4">连接数计算器</h3>
                        <p class="mb-4">服务器最大连接数约等于 `worker_processes` × `worker_connections`。尝试调整下方参数，查看理论最大值。</p>
                        <div class="space-y-3">
                            <div>
                                <label for="worker_processes" class="font-medium">Worker Processes:</label>
                                <input type="number" id="worker_processes_input" value="4" class="w-full mt-1 p-2 border rounded-md">
                            </div>
                            <div>
                                <label for="worker_connections" class="font-medium">Worker Connections:</label>
                                <input type="number" id="worker_connections_input" value="1024" class="w-full mt-1 p-2 border rounded-md">
                            </div>
                            <div class="text-lg font-semibold">
                                理论最大连接数: <span id="max_clients_output" class="text-teal-600">4096</span>
                            </div>
                        </div>
                    </div>
                </div>
                 <h3 class="text-2xl font-semibold mt-10 mb-4">启用 Gzip 压缩</h3>
                 <p class="mb-4">压缩响应体可以显著减少传输数据量，加快客户端加载速度。这是最基本也是最有效的优化手段之一。</p>
                 <div class="bg-white p-6 rounded-lg shadow-sm">
                    <div class="code-block" id="code-perf-gzip">
                         <button class="copy-btn" onclick="copyToClipboard('code-perf-gzip')">复制</button>
                        <pre><code># 在 http 块中添加
gzip on;
gzip_vary on;
gzip_proxied any;
gzip_comp_level 6;
gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;</code></pre>
                    </div>
                 </div>
            </section>
            
            <!-- Section: Security -->
            <section id="security" class="content-section">
                <h1 class="text-4xl font-bold text-slate-900">安全加固</h1>
                <p class="mt-4 text-lg text-slate-600">配置 Nginx 以增强 Web 应用的安全性，防止常见攻击。</p>

                <div class="mt-8 grid md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h3 class="text-2xl font-semibold mb-4">配置 SSL/TLS (HTTPS)</h3>
                        <p class="mb-4">为您的站点启用 HTTPS 是安全的基础。使用强加密协议和套件，并自动将 HTTP 重定向到 HTTPS。</p>
                        <div class="code-block" id="code-sec-ssl">
                             <button class="copy-btn" onclick="copyToClipboard('code-sec-ssl')">复制</button>
                            <pre><code>server {
    listen 80;
    server_name example.com;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl http2;
    server_name example.com;

    ssl_certificate /path/to/fullchain.pem;
    ssl_certificate_key /path/to/privkey.pem;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
}</code></pre>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h3 class="text-2xl font-semibold mb-4">限制请求速率</h3>
                        <p class="mb-4">使用 `limit_req_zone` 和 `limit_req` 指令可以防止暴力破解和 DoS 攻击。</p>
                        <div class="code-block" id="code-sec-limit">
                             <button class="copy-btn" onclick="copyToClipboard('code-sec-limit')">复制</button>
                            <pre><code># 在 http 块中
limit_req_zone $binary_remote_addr zone=mylimit:10m rate=10r/s;

# 在 server 或 location 块中
location /login {
    limit_req zone=mylimit burst=20 nodelay;
    # ... proxy_pass ...
}</code></pre>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section: Cheatsheet -->
            <section id="cheatsheet" class="content-section">
                <h1 class="text-4xl font-bold text-slate-900">常用指令速查</h1>
                <p class="mt-4 text-lg text-slate-600">一份快速参考，涵盖了配置 Nginx 时最常用的一些指令和变量。</p>
                 <div class="mt-8 bg-white p-6 rounded-lg shadow-sm">
                    <div class="grid md:grid-cols-2 gap-x-8 gap-y-6">
                        <div>
                            <h4 class="font-semibold text-lg text-teal-700">核心指令</h4>
                            <ul class="mt-2 space-y-1 list-disc list-inside">
                                <li><code>server { ... }</code>: 定义虚拟主机。</li>
                                <li><code>location [modifier] /uri/ { ... }</code>: 定义URI路由。</li>
                                <li><code>listen &lt;port&gt;;</code>: 监听端口。</li>
                                <li><code>server_name &lt;name&gt;;</code>: 定义主机名。</li>
                                <li><code>root &lt;path&gt;;</code>: 设置文档根目录。</li>
                                <li><code>index &lt;file&gt;;</code>: 设置索引文件。</li>
                                <li><code>try_files &lt;file...&gt; &lt;uri&gt;;</code>: 检查文件是否存在。</li>
                                <li><code>proxy_pass &lt;url&gt;;</code>: 代理请求。</li>
                                <li><code>upstream &lt;name&gt; { ... }</code>: 定义后端服务器池。</li>
                                <li><code>return &lt;code&gt; [text|URL];</code>: 返回响应或重定向。</li>
                                <li><code>rewrite &lt;regex&gt; &lt;replacement&gt; [flag];</code>: 重写URL。</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold text-lg text-teal-700">常用变量</h4>
                            <ul class="mt-2 space-y-1 list-disc list-inside">
                                <li><code>$host</code>: 请求的主机名。</li>
                                <li><code>$uri</code>: 当前请求的URI (不带参数)。</li>
                                <li><code>$request_uri</code>: 原始请求的完整URI (带参数)。</li>
                                <li><code>$args</code> / <code>$query_string</code>: 请求参数。</li>
                                <li><code>$remote_addr</code>: 客户端IP地址。</li>
                                <li><code>$scheme</code>: 请求协议 (http/https)。</li>
                                <li><code>$request_method</code>: 请求方法 (GET, POST)。</li>
                                <li><code>$document_root</code>: 当前请求的根目录。</li>
                                <li><code>$request_filename</code>: 映射到的文件系统路径。</li>
                                <li><code>$http_&lt;header&gt;</code>: 获取请求头，如 <code>$http_user_agent</code>。</li>
                            </ul>
                        </div>
                    </div>
                 </div>
            </section>

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Navigation
            const navLinks = document.querySelectorAll('.nav-link');
            const contentSections = document.querySelectorAll('.content-section');

            function switchPage(hash) {
                hash = hash || window.location.hash || '#intro';
                
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === hash) {
                        link.classList.add('active');
                    }
                });

                contentSections.forEach(section => {
                    section.classList.remove('active');
                    if ('#' + section.id === hash) {
                        section.classList.add('active');
                    }
                });
            }

            navLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    history.pushState(null, null, targetId);
                    switchPage(targetId);
                });
            });

            window.addEventListener('popstate', () => switchPage(window.location.hash));
            switchPage(window.location.hash);


            // Installation Tabs
            const installTabs = document.querySelector('#install-tabs');
            if (installTabs) {
                const tabs = installTabs.querySelectorAll('.tab');
                const tabContents = document.querySelectorAll('#install .tab-content');
                
                tabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        tabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');

                        tabContents.forEach(content => content.classList.remove('active'));
                        document.getElementById(this.dataset.target).classList.add('active');
                    });
                });
            }


            // Config Structure Diagram
            const diagramBlocks = document.querySelectorAll('#config-diagram .diagram-clickable');
            const configInfos = document.querySelectorAll('.config-info');

            diagramBlocks.forEach(block => {
                block.addEventListener('click', function() {
                    diagramBlocks.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    configInfos.forEach(info => info.classList.add('hidden'));
                    const targetInfo = document.getElementById(this.dataset.target);
                    if (targetInfo) {
                       targetInfo.classList.remove('hidden');
                    }
                });
            });
            // Init diagram selection
            document.querySelector('#config-diagram .diagram-clickable[data-target="http-context"]').click();

            // Load Balancer Chart
            let lbChart;
            const lbChartCanvas = document.getElementById('lb-chart');
            if (lbChartCanvas) {
                const ctx = lbChartCanvas.getContext('2d');
                const chartData = {
                    labels: ['Server 1 (w:3)', 'Server 2 (w:1)', 'Server 3 (w:1)'],
                    datasets: [{
                        label: '收到的请求数',
                        data: [0, 0, 0],
                        backgroundColor: ['#14b8a6', '#38bdf8', '#818cf8'],
                        borderColor: ['#0f766e', '#0ea5e9', '#6366f1'],
                        borderWidth: 1
                    }]
                };
                lbChart = new Chart(ctx, {
                    type: 'bar',
                    data: chartData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: '负载均衡算法模拟'
                            }
                        }
                    }
                });

                const lbExplanation = document.getElementById('lb-explanation');
                let simulationInterval;
                
                function resetChart(explanation) {
                    clearInterval(simulationInterval);
                    lbChart.data.datasets[0].data = [0, 0, 0];
                    lbChart.update();
                    lbExplanation.textContent = explanation;
                }

                document.getElementById('btn-round-robin').addEventListener('click', () => {
                    resetChart('轮询 (Round Robin): 按权重顺序循环分配请求。');
                    let currentServer = 0;
                    let counter = 0;
                    let requests = 0;
                    const weights = [3, 1, 1];
                    simulationInterval = setInterval(() => {
                        if (requests >= 10) {
                            clearInterval(simulationInterval);
                            return;
                        }
                        lbChart.data.datasets[0].data[currentServer]++;
                        lbChart.update();
                        counter++;
                        if (counter >= weights[currentServer]) {
                            counter = 0;
                            currentServer = (currentServer + 1) % 3;
                        }
                        requests++;
                    }, 500);
                });

                document.getElementById('btn-least-conn').addEventListener('click', () => {
                    resetChart('最少连接 (Least Connections): 将请求分配给当前连接数最少的服务器。');
                    let requests = 0;
                    simulationInterval = setInterval(() => {
                        if (requests >= 10) {
                            clearInterval(simulationInterval);
                            return;
                        }
                        const data = lbChart.data.datasets[0].data;
                        const minConnections = Math.min(...data);
                        const targetServer = data.indexOf(minConnections);
                        data[targetServer]++;
                        lbChart.update();
                        requests++;
                    }, 500);
                });

                document.getElementById('btn-ip-hash').addEventListener('click', () => {
                    resetChart('IP 哈希 (IP Hash): 来自同一IP的请求始终分配给同一服务器。');
                    let requests = 0;
                    const ips = ['1.1.1.1', '2.2.2.2', '1.1.1.1', '3.3.3.3', '2.2.2.2', '1.1.1.1', '4.4.4.4', '2.2.2.2', '3.3.3.3', '1.1.1.1'];
                    simulationInterval = setInterval(() => {
                         if (requests >= 10) {
                            clearInterval(simulationInterval);
                            return;
                        }
                        const ip = ips[requests];
                        const targetServer = (ip.charCodeAt(ip.length-1)) % 3;
                        lbChart.data.datasets[0].data[targetServer]++;
                        lbChart.update();
                        requests++;
                    }, 500);
                });
            }

            // Performance Calculator
            const workerProcessesInput = document.getElementById('worker_processes_input');
            const workerConnectionsInput = document.getElementById('worker_connections_input');
            const maxClientsOutput = document.getElementById('max_clients_output');

            function calculateMaxClients() {
                const processes = parseInt(workerProcessesInput.value, 10) || 0;
                const connections = parseInt(workerConnectionsInput.value, 10) || 0;
                maxClientsOutput.textContent = (processes * connections).toLocaleString();
            }

            if(workerProcessesInput && workerConnectionsInput) {
                workerProcessesInput.addEventListener('input', calculateMaxClients);
                workerConnectionsInput.addEventListener('input', calculateMaxClients);
            }

        });
        
        // Clipboard function
        function copyToClipboard(elementId) {
            const block = document.getElementById(elementId);
            const code = block.querySelector('pre code').innerText;
            const el = document.createElement('textarea');
            el.value = code;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);

            const button = block.querySelector('.copy-btn');
            const originalText = button.innerText;
            button.innerText = '已复制!';
            setTimeout(() => {
                button.innerText = originalText;
            }, 2000);
        }

    </script>
</body>
</html>
